00:00:00.650 - 00:00:46.198, Speaker A: All right, so thanks very much for the welcome today. I wanted to tell you about loss versus rebalancing or lever for shorts. I have some really great co authors for this work jason Milionas, who's my PhD student at Columbia, CMAC Molemi, who's a professor in the Business School of Columbia and Anthony Li Zhang, who's a professor at the Business School at the University of Chicago. So I want to talk about the incentives faced by liquidity providers and automated market makers like Uniswap. Because in an AMM like Uniswap, really there's only kind of two different parties involved. There's obviously the traders who might be buying and selling, for example, ETH in exchange for, for example, USDC. Now the tokens that they're buying have to come from somewhere.
00:00:46.198 - 00:01:36.646, Speaker A: And so there are these liquidity providers who actually deposit their own tokens into an AMM so that they can be traded against, usually in exchange for a share of the trading fees. And as I assume most of you know, AMMS are really central in DeFi, very popular. They're simple enough, they can be implemented purely on chain, unlike order book formats. And they're also great for guaranteeing liquidity for long tail assets that would otherwise be stuck in thin markets. And in this talk, I want to really focus on a very basic question, which is when does it make economic sense to provide liquidity to an AMM, in the sense that when is the benefit bigger than the cost? And I'm really going to be focusing more on the cost term benefit. I think it's a little clear, like what it is. It's basically whatever fee revenue you're making, plus any additional token incentives.
00:01:36.646 - 00:02:30.074, Speaker A: But how should we think about the cost of providing liquidity? So why is there any cost at all? Actually? Well, sort of part of the price of doing business as a market maker is something known as adverse selection. So in an AMM, basically it's at all times quoting a price at which it would be willing to take either side of a trade, either a buy or a sell. And so what that means is that if you have informed traders trading with you, so traders who have better information about the price of the asset than your AMM currently does, you're going to basically in sort of taking on those trades. You're going to be taking on the wrong end of a bunch of trades, basically trading at stale, inferior prices. So that's fundamentally where LP cost comes from, adverse selection being on the wrong end of trades with informed traders. I hope this question seems self evidently interesting. Obviously, if you're thinking about providing liquidity, this is exactly the question you want to study.
00:02:30.074 - 00:02:59.414, Speaker A: But also, if you're designing your own AMM, you're going to need to incentivize liquidity providers. So it behooves you to understand the costs that they face. And we'll return to this at the end of the talk. So before I start sort of walking you through the theory we've put together. I just want to pause and sort of instantiate that theory in a very, very special case. The details on the slide aren't that important. I just want you to sort of realize right away that from this theory you get very quantitative, very crisp and interpretable answers to the questions that we were just talking about.
00:02:59.414 - 00:03:23.826, Speaker A: So again, theory is quite general. But just for this slide only, let's think about the most canonical kind of AMM there is. Maybe let's think about a constant product market maker like, say, uniswap V one or V two. Let's think about like ETH and USDC as the trading pair. Let's think about a fixed trading fee. It's just 30 basis points. An important parameter for us is going to be volatility of the risky asset, in this case ETH.
00:03:23.826 - 00:04:13.446, Speaker A: So let's take 5% daily volatility, which is a reasonable number for ETH. Typically, what our theory shows is it really just like we can plug in all this information as inputs into our theory, and it will spit back out to you an exact predicted cost of providing liquidity to that pool. Namely, three and an 8th basis points per day, which on an annual basis would correspond to an 11% loss of your assets. Now, it's nice to have a number, but how should you feel about the number? Like, is that number big or small? Well, this is the cost part of the cost benefit analysis, right? So whether this is big or small depends on the benefits. It depends on your fee revenue. We have here a fixed fee, so it's just going to be driven by volume. So you'll be happy as a liquidity provider as long as the volume is sufficiently large, you do the arithmetic.
00:04:13.446 - 00:05:02.938, Speaker A: You find that to break even in this pool, you need about 10% of the pool's assets to be trading daily. Okay? And if it's not, then it's not worth your while to participate in this pool. So that's where we're going. Let me now just sort of build up to how we can actually derive results of that form, all right? And rather than trying to reason about future investment decisions like we just were, now let's start with a hopefully easier question of doing forensics on the past. So imagine we just actually had locked up liquidity in an AMM for a month. We just withdrew it. We want to go back and look at the data and say, okay, was that like a good move or not? And maybe the most obvious idea, many of you will recognize this immediately as a dumb idea, but maybe the most obvious idea is say, well, look, I had some assets at the beginning of the month.
00:05:02.938 - 00:05:23.538, Speaker A: They had some cash value. I put them in this AMM. I waited a month, I got them out. What I got out has some cash value. Let's just compare those two numbers and see if it went up or if it went down. For example, maybe you deposited one ETH and 1000 USDC into an AMM. A month goes by, you withdraw AMMS, may give you a different mix of the assets back.
00:05:23.538 - 00:05:50.394, Speaker A: So let's say you got 0.5 ETH and 2000 USDC back. Should you be happy? Well, you can't answer this question without knowing the price of ETH. So let's say that initially the beginning of the month, the ETH was trading at 1000, whereas it was a really good month for ETH. And at the end of the month, it was trading for 4000. That means the cash value of your deposit at the time of deposit was $2,000. The cash value of your withdrawal at the time of withdrawal was $4,000.
00:05:50.394 - 00:06:46.240, Speaker A: So even ignoring anything you might have made from fees, I guess it seems like a good move. But this is actually really sloppy thinking. Okay, so why is this sloppy thinking? Well, the price of ETH quadrupled in this month, anything you did which involved in some way holding some ETH would be looking pretty good in hindsight right now. Okay, so the smart question to ask is among the various ways that you could have gone long ETH, of course, of which Lping for an AMM is only one of all the ways you could have gone long ETH. How did this particular strategy work out for you compared to the alternatives? All right, so the next question is all right, that's a reasonable question. What alternatives could you look at? Like, how else would you go long ETH? Here's an idea. Buy some, hold it for a little while.
00:06:46.240 - 00:07:23.402, Speaker A: That's the simplest possible way to go long ETH. And in this example, actually, you would have done better had you just bought and hold your original portfolio was one ETH plus $1,000. After the price of ETH quadrupled, that would be worth 5000. Whereas you'll recall that at the end of the pool, your withdrawal was only worth 4000. So you would have made 1000 more dollars from buying and holding as opposed to putting those assets into the AMM. Okay? And so if you've ever heard of impermanent loss, that's often used without a definition. But in the cases where people do define impermanent loss, this is usually what they mean.
00:07:23.402 - 00:07:54.318, Speaker A: They compare. So you, again look at the cash value of the portfolio that you withdraw. But now you assess your initial portfolio not at the original prices, but at the final prices. So in this example, the impermanent loss would be $1,000 loss versus holding. So that's a less obviously bad idea than idea number one. But if we think about it carefully for really not that long, we'll see that actually this is probably not what we're looking for either. This is probably really not the right concept.
00:07:54.318 - 00:08:32.654, Speaker A: Let me tell you one thing about it which seems fishy. Think about this special case where it just so happens that the price of ETH at the end of the month is the same as it was at the beginning. 1000 at the start, 1000 at the end. Maybe it was 1000 the whole time. Maybe it moved all the way around all over the place, but eventually got back to 1000 at the end of the month. Okay, doesn't matter actually, which of those two cases was the case. For all of the most common AMMS, if the only thing you know is that the price when you withdraw is the same as the price that when you deposited, you automatically know you'll be getting exactly the same portfolio back.
00:08:32.654 - 00:09:32.958, Speaker A: If you deposited one ETH and a thousand USDC at the beginning, that's exactly what you'll get back in addition to some fees. What that means is that the impermanent loss is going to be zero, as if you were holding the asset because the price happened to return to its initial value. And again, the impermanent loss is zero whether or not the price stayed constant the whole time or whether it was jumping around all over the place. So even if you're not an expert, start sounding a little weird, like maybe we're not actually capturing the adverse selection costs we were hoping, you know, you've probably heard about arbitrage on AMMS, right? Like, if you've ever heard a talk on mev, you've certainly heard about arbitrage on AMMS. Basically, if the spot price on an AMM is off from the external market price, you can count on arbitragers to make trades on the AMM to correct it, to bring it back to the current market price. Arbitragers do not do this out of charity. They do this because they make money by correcting the spot price of AMMS.
00:09:32.958 - 00:10:13.262, Speaker A: All right? And now okay, so if arbitrage are making money, whose money is that? Where is that coming from? Well, like we said, there's really only two actors in an AMM. There's the traders or arbitrage, and there's the liquidity, the LPs. So whatever the arbitrage are making must be at the expense of LPs. So we should expect whatever our notion of LP cost we're going to use, we should expect it to be increasing with the frequency of arbitrage opportunities. If a price stays constant for a whole month, there are no arbitrage opportunities. If the price is moving around all over the place, there's going to be a lot of them. So we should expect the cost of Lping to scale with the price volatility.
00:10:13.262 - 00:10:47.674, Speaker A: And as we see, impermanent loss does not do that. All right? So again, this was idea number two at least was a better idea. At least we had a reference strategy for comparing sort of how we did with the AMM. And so what's clear now is just we need a more nuanced reference strategy. So that brings us to what we call the rebalancing reference strategy, and that's the R in LVR in lever. Now, different AMMS will correspond to different reference rebalancing strategies. So let me explain this.
00:10:47.674 - 00:11:41.242, Speaker A: First, for the case of the canonical case of a constant product market maker like uniswap v one and v two, I'll tell you the general definition on the next slide. This is also where it's most clear why we use the phrasing rebalancing for this. Because a constant product market maker like uniswap v two, it's not usually described this way, but you can literally think of it as just something that's doing automated portfolio rebalancing. Constant product AMMS literally set spot prices so that the cash value of both sides of the pool have exactly the same USD value. Okay? So if you have $10,000 on one side of your pool, there's going to be $10,000 of ETH on the other side of the pool at whatever the current market prices happen to be, okay? So that pool actually is doing rebalancing. It's keeping the two sides equal value. The way you carry that out with a little arithmetic, you just use a spot price of y over X.
00:11:41.242 - 00:12:13.686, Speaker A: Here, y is the amount of USDC, x is the amount of ETH. Notice that as X gets smaller, as ETH gets scarcer, the price of ETH goes up. So the more you buy, the more expensive it gets. The way you actually implement this spot price is through you do it implicitly through an invariant. And that's where the X times y and the XY equals K phrase comes from. Basically, you just force trades to stay on a level set of an invariant function, which in this case is X times y in any case. So this AMM is in effect doing rebalancing, keeping the cash values of both sides exactly the same.
00:12:13.686 - 00:12:42.062, Speaker A: So, for example, if the market price of ETH jumps from 1000 to 4000, maybe initially the pool had one ETH and 1000 USD. So it was totally kind of in balance. When the market price of ETH jumps to 4000. All of a sudden buying ETH from this pool looks super cheap. So you can count on arbitrariors to do that. They're going to keep buying ETH, driving up the price until the spot price of the pool matches the new market price of 4000. A little arithmetic shows that happens after arbitrariors have bought 0.5
00:12:42.062 - 00:13:21.914, Speaker A: ETH out of the pool at a per ETH price, it turns out of $2,000 and you wind up with this new pool, which at the new market prices has value 4000. So the reference strategy, what else could you do? Something else you could do is copy the trade of the AMM. So when the price jumps from 1000 to 4000, you say, oh, the AMM is selling 0.5 e. Let me just sell 0.5 ETH myself, not via the AMM, but directly in an external market with deep liquidity think finance. Okay? So rather than selling 0.5
00:13:21.914 - 00:13:52.338, Speaker A: ETH through the pool, I'm just going to sell 0.5 e directly on finance, on the current price of 4000, you're going to do better because you're selling the same quantity at a higher price. You're selling it at 4000 rather than 2000. So you get 1000 more in your portfolio from this reference strategy. And that's the lever of this one trade. For a sequence of trades, you just add up the lever trade by trade. Let me continue the example, just because, remember we criticized impermanent loss of being independent of the price trajectory.
00:13:52.338 - 00:14:17.920, Speaker A: It didn't matter if the price stayed constant or the price went up and down. So let's look at lever. Suppose that now the price of ETH jumps right back from 4000 to 1000 if you've just left your assets in the AMM. This AMM is basically reversible. So when the price goes back, the AMM just goes back to its previous state. In effect, it buys back that 0.5 ETH at that same per ETH price of 2000.
00:14:17.920 - 00:14:43.906, Speaker A: Whereas if you're doing the reference rebalancing strategy, you will again copy the trade. You will yourself be buying 0.5 ETH, but you'll be doing it on the open market. You'll be doing it on, for example, finance at the actual correct market price of 1000. Okay? And so by virtue of buying lower than you would be through the AMM. Again, further lever accrues. It was 1000 after one trade, it's 1500 after the second trade.
00:14:43.906 - 00:15:16.414, Speaker A: And this example should make us feel like we're on the right track if you think back to our criticisms of impermanent loss. So first, evidently lever depends on the trajectory of the prices, not just the initial and final prices. If the price never moved, the lever would be zero, where the price here did move and returned. And the lever is certainly not zero. So that's good. And it's also sort of satisfying how it accumulates with every trade, right? Because if you think about the intuition for the adverse selection cost, any trade at any time, buy or sell, you have the same worry. You worry you're on the wrong side of an informed trader.
00:15:16.414 - 00:15:46.854, Speaker A: So every trade should give you some additional cost. So that's how levers defined for the specific case of a constant product market maker. Given that, I don't think you'll be surprised by the definition in general. So now we're thinking about a totally arbitrary AMM. It doesn't matter which one a sequence of end trades that take place in that AMM. Again, the lever is just computed sort of trade by trade. And the lever of a given trade is just the quantity traded.
00:15:46.854 - 00:16:30.090, Speaker A: So AI here denotes the amount of ETH bought or sold in the pool at that trade. And then so it's just the quantity traded times the difference in the prices, the difference in the price you get by trading through the AMM versus using the reference strategy and trading directly, for example, on binance. So you're going to, for example, be picking up lever whenever AI is positive. That means that you're selling and if you're selling at too low a price, if Q is less than P, you're going to pick up some lever. Similarly, if you're buying and P is less than Q, you're also going to pick up some lever. This depends on the AMM, because different AMMS will be quoting different QIS, different prices. Given a fixed quantity, given an AI, different AMMS will give you different QIS.
00:16:30.090 - 00:17:14.360, Speaker A: So that's lever in general, let me make some comments about it. So something that, again is a good sanity check for us. It shouldn't surprise you, and it's pretty trivial to prove we've been talking about lever as the loss to liquidity providers, you could alternatively derive it as the kind of best case profit that arbitrators could possibly extract. Okay? Best case meaning assume they had access to sort of infinite liquidity at the current market price and didn't have to pay any trading fees. And this shouldn't surprise you because we already talked about the zero sum game happening between arbitrage and liquidity providers. So LP's losses just have to be arbitrary's gains. And so we're seeing that reflected here.
00:17:14.360 - 00:17:55.140, Speaker A: And I would encourage you to interpret lever as really actually isolating the costs of adverse selection appropriately. Okay? So it follows the price trajectory as it should. It accumulates trade by trade, as it should. It depends on the particular AMM that you're talking about, as it should. So this has all been about forensics looking at the past for which we have data and reasoning about what we did before, whether it was a good idea or not. How about predicting the future? Obviously sort of the more interesting question for assessing investments. Also, I want to fulfill the promise of where that three and 8th and one eight basis points come from, and I'll need this model for that.
00:17:55.140 - 00:18:33.546, Speaker A: So, thinking ahead, when is the benefit bigger than the cost of Lping? Again, I want to focus on the cost. So how do we reason about what lever is likely to be going forward? As we've said, lever depends on the trajectory of prices. So to reason about the lever in the future, we need some assumptions about what prices are going to do. We need a model of price evolution. You can imagine doing various things here. We did probably the most obvious basic one, which is just the standard model, sort of in continuous time finance, black Scholes model. Some of you know this model and that's great, some of you don't.
00:18:33.546 - 00:19:16.714, Speaker A: And that's totally fine if you don't know it. The one key point is that at least for the most basic model, there's really just sort of one parameter that really matters, which is the volatility sigma of the asset. And if you're thinking of prices as being some kind of random walk, you can loosely think of sigma as like the typical length of a step in that random walk. Okay, so we want to reason about lever under this assumption about how prices will evolve in the future. Now, the answer is not going to be some number like two, right? It's going to depend on various things. And we sort of already know a couple of things it must depend on. It must depend on the volatility, right? Sigma zero means the price is constant.
00:19:16.714 - 00:19:50.022, Speaker A: Sigma big means prices jumping all over the place. As we discussed, prices jumping all over the place means arbitrage opportunities. That should mean nontrivial lever. So we expect lever to be increasing in sigma. And we've also seen that it depends on the AMM because different AMMS will quote you different prices for a given trade. So the best case scenario then would be something which just takes as input the AMM and sigma and gives us back an easy to evaluate formula for what the lever will be under this model. So here's a formula, I'll leave it to you.
00:19:50.022 - 00:20:17.522, Speaker A: Whether you think it's clean or not probably depends on sort of your priors about this. If you don't find it clean, let me say this is going to simplify dramatically for popular AMMS as I'll show you on the next slide. All right, so this is the general version of lever. So remember, we're in a continuous time model now, so we're thinking of trades happening constantly all the time. Remember, lever accumulates trade by trade. So that's why you see this integral here. We're integrating over the time horizon from time zero to the final time T.
00:20:17.522 - 00:20:47.626, Speaker A: At any moment in time we're incurring some instantaneous lever. That's the little L. There is an explicit formula for the instantaneous lever, as you see here. Minus one half times quantity sigma p s squared. Remember, sigma is the volatility of the assumed price model. P sub S just denotes the current market price at time s that's squared. And then that gets multiplied by the marginal liquidity of the AMM at the current price p sub S.
00:20:47.626 - 00:21:21.506, Speaker A: What do I mean, marginal liquidity? I mean, imagine the market price changes a little bit like the market price of ETH goes from 1000 to 1001. That means the AMM is going to wind up selling off some of its ETH. And the question is, just how rapidly does it sell off ETH as a function of that small increase in price? That's what I mean by marginal liquidity. That's going to be different for different AMMS. So, as expected, our formula for lever depends on sigma, the volatility. In fact, it scales as sigma squared. And secondly, it depends on the AMM.
00:21:21.506 - 00:22:01.086, Speaker A: Although actually, for instantaneous lever, it depends on the AMM in only a very local way. All that matters about the AMM is its marginal liquidity at the current market price p sub S. So this is true no matter what the AMM is. You can actually, because popular AMMS are sort of so simple, you can actually compute closed formulas form for this. For many of the DEXes that you will have heard of. Let me do the computation solely for the constant product market maker case. You can see the paper for other constant function market makers and for uniswap V three, et cetera.
00:22:01.086 - 00:22:39.658, Speaker A: So lots of things can be evaluated in closed form. So I've reminded you the definition of lever up at the top. And now really, honestly, you just turn the crank, do a little calculus, and it all works out. First thing you need to do is you need to compute that marginal liquidity. So if you have a uniswap V two pool, for example, with a certain liquidity level, exactly how much do the assets of ETH, for example, go down as a function of increases in the price of ETH? Okay, it's a very simple invariant curve. It's just x times y. Do a little calculus, implicit function theorem, and you get a formula for the marginal liquidity of a constant product market maker.
00:22:39.658 - 00:23:09.660, Speaker A: You now literally just plug this formula in. So you plug this expression into the formula on the upper right, you get whatever you get. It's sort of there on the slide. So that's an explicit formula for the instantaneous lever suffered in this pool. And what's interesting is to normalize this by the value of the assets in the pool, which it turns out also at equilibrium, you can derive just from the pool's liquidity. And whatever the current market price is, there's some simple formula for that. And then the ratio is what we're interested in.
00:23:09.660 - 00:23:36.610, Speaker A: This is exactly where the 3.125 basis points comes from. So the instantaneous lever normalized by the pool value, that turns out to be sigma squared over eight. Exactly. So if you plug in 5% volatility, if you plug in sigma equals zero five, then that's where you get the 3.125 from. You also see that actually volatility is really important.
00:23:36.610 - 00:24:13.510, Speaker A: So if you doubled, for example, the volatility from 5% to 10%, this would double the corresponding requirement on volume. Remember, this was the calculation that you then sort of say, okay, as a liquidity provider, am I happy, am I sad with this number? Well, it depends on my fee revenue. Fee revenue depends on volume. So really this just tells you what kind of volume you need to expect for Lping to be a good idea. Okay. All right, so let me wrap up takeaways. So we argue that lever is really the first concept that properly isolates the adverse selection costs that are faced by liquidity providers of automated market makers.
00:24:13.510 - 00:25:04.970, Speaker A: And again, what's the idea? The idea is you compare to a reference strategy. In that sense, there's a sort of similarity to impermanent loss or loss versus holding. But it's a more sophisticated reference strategy where you copy the trades of the AMM but execute them not through the AMM itself, but rather on the open market. I think it was hopefully self evident from the early part of the talk that this is very easy to measure from data. And we also saw just now that in a standard black Scholes model for popular AMMS, you can actually compute lever explicitly. So going back to our sort of initial questions, so the first question is, when does it make sense to be an LP? When does it make good economic sense? Well, the answer you get out of here is that, well, your benefit should be exceeding the lever. The lever, we argue, is the cost your rewards are coming from, perhaps token rewards, definitely from fee revenue.
00:25:04.970 - 00:25:44.694, Speaker A: And that should be exceeding the lever for you to actually want to LP for a particular pool. This, of course, has implications for the design of automated market makers. This says if you want your liquidity providers to be properly incentivized their rewards, their fee revenue should be scaling with the lever. Now remember, lever depends in particular on volatility, actually as sigma squared. So if the volatility doubles, all of a sudden you need the fee revenue to go up by four x. So if you want to design an AMM so that the fee revenue generated is scaling with the lever, you might want to think about dynamic fees. You need to be worried about volatility, you need to be worried about volume.
00:25:44.694 - 00:26:31.602, Speaker A: You could either have fees that depend directly on those two quantities, or you could even just measure what the historical lever has been recently and use that to adjust fees. Another implication sort of all else being equal, you obviously want to make the lever as small as possible. The less lever the LPs are losing, the less you need to incentivize them to get them to add liquidity to your pool. So how would you reduce lever keeping all else equal? Well, one idea would be to quote prices not naively using the AMM curve as we're used to doing, but rather using sort of more updated prices than what the naive AMM calculation would give you. For example, by incorporating some kind of pricing oracle. That, of course would open up a whole nother can of worms. But our work does sort of quantify how much better things would be if you could safely incorporate a price oracle into your AMM.
00:26:31.602 - 00:26:43.520, Speaker A: I'm told there are already several groups sort of working on these ideas. They're definitely not new ideas to us, but hopefully this work does put these ideas on sound mathematical footing. So I think I'm out of time. Let me stop there. Thanks.
