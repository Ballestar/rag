00:00:00.490 - 00:00:25.040, Speaker A: So we left off the the last video with the basic intuition about why this famous impossibility result is true. Again, the result states that in the partially synchronous model, you cannot achieve consistency plus eventual liveness unless the number of Byzantine nodes is strictly less than a third. So this is again that magical 33% threshold that you see in lots of different blockchain white papers and discussions all over the place.
00:00:25.040 - 00:00:36.022, Speaker A: So in this video, I want to actually provide you with a rigorous proof of this very famous impossibility result. Let me remind you of the statement. So, we're talking about the partially synchronous model.
00:00:36.022 - 00:00:52.058, Speaker A: So, an asynchronous phase followed by a synchronous phase. So there's two parameters. A known bound capital delta on the maximum message delay once you actually reach that synchronous phase, once you resume normal operating conditions, and then the second unknown parameter, GST global Stabilization Time.
00:00:52.058 - 00:01:06.062, Speaker A: So at some point at some finite time, but the protocol doesn't know when there will be this transition from the asynchronous to the synchronous phase. That is, whatever attack you're under will eventually end. And in this model, the magic threshold is 33%.
00:01:06.062 - 00:01:24.402, Speaker A: So we're going to get an impossibility result if a third or more of the nodes are Byzantine. And again, when you see 33%, for example, malicious stake or something like that, when people are talking about blockchain protocols, this is literally that 33%. I'm going to state the impossibility result for a single shot consensus problem, namely Byzantine agreements.
00:01:24.402 - 00:01:34.282, Speaker A: But this is going to automatically apply more generally to the multi shot consensus problem. State machine replication. Let's remember what our goals are in the partially synchronous model.
00:01:34.282 - 00:01:52.490, Speaker A: So again, during that asynchronous phase, while we're under attack, the FLP impossibility result tells us we have to give up on something. We're not going to have safety and liveness simultaneously during that asynchronous phase. However, after we switch to the synchronous phase after GST, we would like to have both safety and liveness.
00:01:52.490 - 00:02:10.742, Speaker A: We'd also like to give up as little as possible in the asynchronous phase. And so the traditional consensus goal there is to retain safety but give up on liveness during that asynchronous phase. In the context of Byzantine agreement, this means we want a protocol that satisfies the agreement property always.
00:02:10.742 - 00:02:28.310, Speaker A: So it's always the case that everybody's output of all the honest nodes is exactly the same. And then we want sort of validity and termination to hold eventually after the Global Stabilization time. So not only do all of the nodes output exactly the same thing, if they halt, eventually they will halt possibly after GST.
00:02:28.310 - 00:02:57.580, Speaker A: Oh, and by the way, if they all started with the same input, then they should all be outputting the same output. So we concluded the last video with the basic intuition about why this result is true and in particular why this seemingly magical 33% threshold is actually quite natural. Once you sort of are thinking about the problem in the right way.
00:02:57.580 - 00:03:15.566, Speaker A: Now remember, the intuition had two parts, both pretty hand wavy, but still on some level I think reasonably accurate. So the first part of the intuition, it's like, look, got a Byzantine agreement protocol. It satisfies eventual termination, right? So that means if you're an honest node, you can't wait forever to hear from everybody.
00:03:15.566 - 00:03:30.882, Speaker A: Because for all you know, there's sort of one or more byzantine nodes out there that are never going to tell you anything ever. Neither in the asynchronous phase nor in the synchronous phase. So you have to be ready for up to f Byzantine nodes to literally just give you the silent treatment and never tell you anything.
00:03:30.882 - 00:03:46.278, Speaker A: So that means you need to make a decision. After hearing from a total of N minus f nodes, including yourself, you might never hear from the remaining little f nodes. Now the big bummer here is that you have to take action, perhaps having never heard from these f nodes.
00:03:46.278 - 00:03:50.998, Speaker A: But maybe they're not Byzantine. Actually. Maybe these nodes were not giving you the silent treatment.
00:03:50.998 - 00:04:01.118, Speaker A: They're honest nodes. They were honestly sending you the messages they're supposed to be sending, but they just haven't arrived. Okay? And that means you're still in the asynchronous phase before the global stabilization time.
00:04:01.118 - 00:04:24.162, Speaker A: So never forget, the GST parameter in the partially synchronous model is unknown to the protocol. So a protocol has no idea when it's going to be, it's going to happen sometime, doesn't know when and it can't necessarily detect immediately when it has happened. So the threat of f byzantine nodes giving you the silent treatment actually forces your hand to take action after hearing from only N minus F nodes.
00:04:24.162 - 00:04:46.618, Speaker A: Unfortunately, if the f nodes you haven't heard from are honest, the f Byzantine nodes are going to be lying in weight. They'll be part of the N minus f nodes you heard from, like wolves in sheep's clothing. Now intuitively, if half of the nodes you're hearing from are Byzantine, well, they might be sort of conspiring against you and feeding you misleading information.
00:04:46.618 - 00:05:04.222, Speaker A: So intuitively you run the risk of getting tricked if half the nodes you hear from are Byzantine. So intuitively it seems like a minimal condition is you need a strict majority of the N minus F nodes you hear from to be honest. So less than 50% of those N minus F nodes should be Byzantine.
00:05:04.222 - 00:05:27.986, Speaker A: And then a little arithmetic tick says that this back of the envelope argument suggests that you have no hope unless there's less than a third Byzantine nodes. So intuition is great, but for such an important result, I really do think it's good to see the proof. Now I'm going to prove the same special case that we also proved in our other N over three threshold impossibility result.
00:05:27.986 - 00:05:53.714, Speaker A: So that was back in lecture three when we were thinking about the synchronous model and we showed the necessity of the PKI assumption for the dull of strong protocols guarantees. So we showed that if you don't have this trusted setup assumption, if you don't have PKI, even in the synchronous model, you can't solve back then we were talking about Byzantine broadcast, you can't solve it with a third or more Byzantine nodes. So that was the point of that lecture three impossibility result, the importance of PKI in the synchronous model.
00:05:53.714 - 00:06:17.670, Speaker A: And you might recall that that hexagon proof was specifically for the case of three nodes total, one of which was Byzantine. That's the same special case we're going to look at on this slide. I'm going to say exactly the same thing I said back in lecture three, which is this may seem like a totally trivial case, it may seem like I'm completely cheating by only telling you sort of the smallest imaginable case of this theorem.
00:06:17.670 - 00:06:44.862, Speaker A: But actually, maybe surprisingly, this captures basically the entire argument. So I'm going to leave it as an exercise, a good exercise for you to think through how you would take the argument I'm about to show you and extend it to the general case. So any choices of F and N such that N F is at least a third of N, there's two approaches you could take to this generalization, both of which can be made to work.
00:06:44.862 - 00:06:58.306, Speaker A: So one is to just sort of take the proof I'm about to write down and just make the appropriate modification. So it holds in general. So in general, if you're given sort of like 100 nodes, 34 or more of which are Byzantine, you're going to group them into three groups.
00:06:58.306 - 00:07:18.086, Speaker A: You put the 34 Byzantine nodes in one group, you take the honest nodes, put them in two different groups of sort of 33 each. You think of those groups as kind of meta nodes in some sense and then you carry through this same argument. Alternatively, it's always good to be on the lookout for reductions, to sort of take something you want to prove and sort of reduce it to something you already have proved.
00:07:18.086 - 00:07:41.380, Speaker A: And you can take that approach here as well. So you can show that for an arbitrary choice of F and N, where F is at least a third times N, if in fact you could solve it. So if in fact you could have a Byzantine agreement protocol with these properties, then you could extract from it an equally good protocol for the N equals three and F equals one case, which would be a contradiction given the argument I'm about to show you now.
00:07:41.380 - 00:07:59.500, Speaker A: So we have N equals three nodes. Let's call those nodes Alice, Bob and Carol and visualize them as a light blue triangle. And in fact, B will stand not only for Bob but also for okay, so the Byzantine node will be the one in the lower left.
00:07:59.500 - 00:08:10.170, Speaker A: Remember, we're thinking about the Byzantine agreement problem. So that's the consensus problem where each of the nodes gets its own private input. So let's say Alice starts out the protocol with a private input of one.
00:08:10.170 - 00:08:19.390, Speaker A: Carol starts out with a zero. Bob, it doesn't matter because Bob's Byzantine and can just lie about whatever its private input is. So we don't even really think about its private input.
00:08:19.390 - 00:08:36.054, Speaker A: So let's proceed by contradiction. Let's assume that there's a Byzantine agreement protocol that actually does satisfy agreement validity and eventual termination and then derive from that assumption a contradiction. So let's begin with the adversaries plan of attack.
00:08:36.054 - 00:08:52.310, Speaker A: And remember, what's really tricky about sort of the asynchronous model and then also the partially synchronous model is that you really have two different types of adversaries and you have to handle the case where they're conspiring against you. So first of all, there's the Byzantine nodes. In this case, we have exactly one Byzantine node.
00:08:52.310 - 00:09:05.070, Speaker A: But they can, for example, give you the silent treatment, sort of never respond to anything. Or they can sort of send inconsistent information to different honest nodes. Secondly, there's the adversary in control of the message delivery system.
00:09:05.070 - 00:09:13.922, Speaker A: Now, after GST, that adversary doesn't have that much power. They have to deliver every single message within delta time units. But before the global stabilization time.
00:09:13.922 - 00:09:37.420, Speaker A: That's a very powerful adversary that's delivering or not delivering the messages, as the case may be in that asynchronous phase. And so, in particular, that second adversary, one thing they're going to be doing is they're going to be delaying all communication between Alice and Carol for a long period of time. How long? We'll say that toward the end of the proof, but for a long period of time.
00:09:37.420 - 00:09:58.458, Speaker A: So with all lines of communication between Alice and Carol severed for this period of time, neither of them learns anything about what's happening in the protocol other than their interactions with Bob. Bob, of course, is the Byzantine node. And remember, the canonical ploy of a Byzantine node is to send sort of different messages, inconsistent messages to different honest nodes.
00:09:58.458 - 00:10:14.674, Speaker A: And that's exactly what Bob is going to do here. So in particular, Bob will interact with Alice as if he were an honest node and had the private input one. And I'm sure you can guess what Bob's going to do with Carol.
00:10:14.674 - 00:10:43.438, Speaker A: Bob will interact with Carol as if he were an honest node with the private input of zero. So adopt the perspective of Alice, right? So Alice is hearing these messages from Bob and hearing nothing from Carol. And so Alice is really in a Catch 22 at this point, right? I mean, on the one hand, Alice is well aware the one explanation for what she's seen is that Carol is honest and the messages from her have been delayed up to this point.
00:10:43.438 - 00:11:01.330, Speaker A: Alice knows that's a possibility. On the other hand, another possibility Alice has to reckon with is that Bob is actually an honest node and that Carol is Byzantine. And if Carol's Byzantine then messages may never arrive at all, right? Carol may just be giving Alice the silent treatment.
00:11:01.330 - 00:11:21.642, Speaker A: So for all Alice knows, Bob really is an honest node with input one, carol is actually Byzantine. And then because we're assuming that this protocol satisfies eventual termination and agreement. So first of all, eventual termination says Alice eventually has to do something even though she hasn't heard from Carol yet.
00:11:21.642 - 00:11:51.220, Speaker A: And then know if it were in fact true that Bob was honest with input one, then because Alice's input is also one, her output on termination would need to be one. So Alice, having heard nothing from Carol and having heard sort of messages from Bob, consistent with Bob being an honest node with private input one must, by termination and validity, eventually output one. Let's call the time at which Alice does output one T sub one.
00:11:51.220 - 00:12:18.920, Speaker A: Right? And the story is the same from Carol's perspective, who finds herself in her own Catch 22. So Carol's heard nothing from Alice and has been interacting with this node. Bob, you know, that appears to be an honest node that has a private input of zero.
00:12:18.920 - 00:12:40.938, Speaker A: Now, Carol is well aware that, in fact, Bob might be Byzantine and Alice might be honest and it's just that Alice's messages have been delayed. On the other hand, this current situation is indistinguishable from the possibility that actually Bob really is honest, really does have private input zero. Alice is the Byzantine node and is just going to give Carol the silent treatment forever.
00:12:40.938 - 00:13:34.498, Speaker A: So because of the threat of that possibility that Carol will literally never hear from Alice, and because we assume this protocol satisfies eventual termination, at some point Carol has to output a bit. And moreover, by validity, because Carol's private input is zero and for all she know, Bob is an honest node who also has a private input of zero, that means Carol has to output at this time, t two has to output eventually the bit zero. So let's now switch back from talking about what the Byzantine node, Bob is doing to talking about what our other adversary, the message delivery adversary, what they're doing.
00:13:34.498 - 00:13:44.614, Speaker A: And having derived this, that Alice. If Alice doesn't hear anything from Carol, she decides something by T one. Carol, if she doesn't hear anything from Alice, decides by some time T two.
00:13:44.614 - 00:14:07.528, Speaker A: Now it's clear what the message delivery adversary should do, which is just prevent Alice and Carol from talking to each other until they both make decisions. So that is, all of their messages will be delayed beyond the maximum of the times T one and T two. And this, remember, is a legitimate strategy for the adversary in the partially synchronous model.
00:14:07.528 - 00:14:17.480, Speaker A: And here we're really using the fact that the adversary gets to choose the Global Stabilization Time. It must exist. There must be some finite time beyond which message delivery is guaranteed.
00:14:17.480 - 00:14:26.924, Speaker A: However, the adversary gets to choose when that transition time happens. And can choose it as a function of the protocol in question. And we see exactly that here.
00:14:26.924 - 00:14:56.088, Speaker A: Right, so the protocol specifies what are these sort of timeouts, capital T one and capital T two, by which Alice and Carol make decisions, and as a function of sort of how long the protocol takes to time out. As a function of that, the adversary pushes GST far enough out into the future so that it's legitimate that Alice and Carol would literally never hear anything from each other before coming to their independent decisions. So now we can see that we're done.
00:14:56.088 - 00:15:11.760, Speaker A: So, given that this is something the adversary really could do, it's allowed to do this in the partially synchronous model, it winds up forcing Alice to output one, Carol to output zero. However, Alice and Carol are both honest. Byzantine agreement says that honest nodes always have to output the same thing.
00:15:11.760 - 00:15:19.688, Speaker A: And so here we have violated that. Then that completes the contradictions. We assumed that this protocol existed, satisfying agreement validity and eventual termination.
00:15:19.688 - 00:15:34.196, Speaker A: And from those three properties, we actually showed that that protocol couldn't exist after all. So that's the proof. And you now know in a very precise mathematical sense, exactly why you have this fundamental barrier.
00:15:34.196 - 00:16:02.430, Speaker A: At 33%, what fraction of the participants in a consensus protocol are allowed to be Byzantine before things start going haywire? So, again, this is the argument for the seemingly special case of N equals three and F equals one. But again, that really captures basically the full complexity of the argument. And if you're interested, I do encourage you to spend some time after the video thinking through how you would extend this argument to the general N and F case whenever F is at least N over three.
00:16:02.430 - 00:16:19.410, Speaker A: We have one more thing to do in lecture six. That'll be in the next video, where we're going to relate the sort of possibility and impossibility results that we're seeing in the partially synchronous model to a very famous principle from distributed systems known as the Cap theorem. I'll see you there.
