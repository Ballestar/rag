00:00:00.330 - 00:00:28.102, Speaker A: You. Hi, everyone. Welcome to Unconfirmed, the podcast that reveals how the marquee names in crypto are reacting to the week's top headlines and gets the inside scoop on what they see on the horizon. I'm your host, Laura Shin. Crypto Law, aka Kellman Law, is a New York law firm run by some of the first lawyers to enter crypto in 2013 with expertise in litigation, dispute resolution, and antimoney laundering. Email them info at kellman law. Crypto.com,
00:00:28.102 - 00:00:52.060, Speaker A: the crypto super app that lets you buy, earn, and spend crypto in one place. Download the crypto.com app today, Etoro is one of the largest trading platforms in the world, with over $1 trillion in trading volume on the platform per year. US. Customers can trade the most popular crypto assets with transparent fees. Create an account today@etoro.com, that's eToro.com.
00:00:52.060 - 00:01:01.274, Speaker A: Today's guest is Lev Livnep, a formal verification researcher@dap.org and a founding partner at Symbolic Capital Partners. Welcome, Lev.
00:01:01.402 - 00:01:02.794, Speaker B: Hi. Hi, Laura.
00:01:02.922 - 00:01:18.950, Speaker A: The crypto community has been talking about two big exploits or hacks or attacks or whatever they were on BZX in the last week. Can you give us a brief overview of what happened and afterward we'll dive into the details on each exploit?
00:01:19.370 - 00:02:30.886, Speaker B: Sure. So the first thing that happened that's been in the news is on early morning on Saturday or late night on Friday, depending where you are, there was a transaction that did something quite unusual with the smart contract on BZX. And one of the kind of most notable things about it that jumps out at you at first before you can figure out what exactly is going on, is that this thing interacted with a bunch of different protocols and was also moving quite a lot of money around, much more than you'd see in a typical transaction that used any of these features. So, kind of in brief, this transaction started by borrowing a lot of ether from dYdX using their flash lending facility. I then called into BZX and opened up this huge leverage position. So a much larger leverage position than smart contract would typically be used for. And at the same time, rather straight after that, it also opened a position on compound and used some of the ETH collateral that it borrowed to borrow an asset called WBTC wrapped Bitcoin, which was also the asset that was involved in the transaction in BZX.
00:02:30.886 - 00:02:58.440, Speaker B: And then straight after that, after whatever happened inside BZX, it then did another huge trade on Uniswap using the wrap BTC that it just borrowed. And then somehow at the very end, they were able to close out this whole operation by repaying the flash loan that it started with, and then they'd come out with assets at the end of it that they didn't start with. Right. So this was the first thing that was noticeable here, was that something was very wrong.
00:02:59.210 - 00:03:18.282, Speaker A: And the second exploit did something similar, where, again, they were able to make off with a lot more money than they were leaving behind, even though in the flash loan model, what should be happening is that you repay the loan. Is that kind of how you would characterize it?
00:03:18.416 - 00:03:54.706, Speaker B: You're right. So the second attack was kind of similar. It was actually a little bit simpler. But in both cases, it's important to note that all of the flash loans that were actually issued in the first case and the second case were properly repaid. So essentially, there was never a bug in the flash lending functionality of any of these protocols per se. So the key promise with a flash loan that you repay the loan at the end of the transaction. This all happened really where the danger came from was that these flash loans were used to finance essentially, well, essentially what I would just call a straightforward smart contract hack.
00:03:54.706 - 00:04:10.860, Speaker B: So a hacker exploiting a smart contract vulnerability, but the sort of vulnerability that actually requires you to have capital upfront in order to be able to exploit it. And in both cases, flash lending was used to finance this, essentially by an attacker who didn't need to bring any of their own capital to the attack.
00:04:11.390 - 00:04:18.590, Speaker A: And so you're saying that flash loans aren't really the problem. So when you say this smart contract vulnerability, what was that?
00:04:18.740 - 00:05:29.110, Speaker B: Right, so in the first case, and I think both of these are actually fairly I would just definitely describe both of them as fairly subtle issues. So it's not easy to kind of just satisfyingly summarize it in a few words. But to attempt to summarize it in a few words, the first one kind of took advantage of basically, I think, in my opinion, two separate facts about the BZX smart contracts. The first one is that essentially these smart contracts that were used for opening leverage positions used external exchanges in order to source liquidity for trading, right? So BZX, if you want to open a leverage position, you actually need to do some trading in order to accomplish that. And that means essentially, you send in some assets, you maybe borrow some assets, but then you go out somewhere and you do a trade in order to actually open this position. And so the first issue that I'm referring to is the fact that essentially these smart contracts were quite comfortable opening a huge leverage position and doing a lot of trading without any regard for the slippage that they were creating. So essentially, these trades had very, very high impact on the exchanges where they were being executed.
00:05:29.110 - 00:06:25.922, Speaker B: Even figuring out how those trades looks was a little bit complicated because BZX is connected to a decentralized exchange called kyber in order to do these trades, but kyber itself is then connected to other decentralized exchanges. So in this case, kyber was actually routing these trades to an exchange called uniswap. And then what was happening in effect, was these huge trades were being rooted to uniswap. And when they were executing on uniswap, they were generating huge slippage. So actually the price at which the trade was executing was much, much poorer than the market price just because the size of the trade was so large relative to the liquidity available on that exchange. So this is where the first issue came from, is essentially these trades were generating huge slippage and the smart contract, in my opinion, wasn't really designed to handle this in the right way. But where this became really bad is the fact the second issue is that if the trade actually generated enough slippage then it could cause the entire position to become insolvent from the beginning.
00:06:25.922 - 00:07:22.970, Speaker B: Essentially because there was supposed to be a safety check at the very end of opening such a position that checks whether or not the position ends up being safe. So essentially whether the position is subject to liquidation when this position is created. And the check is of course supposed to make sure that the position is not subject to liquidation after being created because you want to only be able to open safe positions. But it turned out that this check was actually just completely incorrectly implemented. So there was what I would call basically a straightforward logic bug just in that check, where this check was actually never being made in this situation. So with any position that anyone had ever opened on BZX, I think in these particular circumstances the check was not happening. So essentially, if you're able to incur enough slippage when opening one of these positions, you could make this position underwater.
00:07:23.630 - 00:07:51.410, Speaker A: So I just want to clarify something. I did see in a Bzx blog post that they essentially said that this was an issue with flash loans and not with their platform, that a similar thing could have happened on using flash loans with dYdX or on AV, I think it's called Aave. I'm not sure how to pronounce the name of that protocol, but are you saying the opposite, that actually it is due to a vulnerability in their particular smart contract?
00:07:51.990 - 00:08:54.582, Speaker B: Yeah, I think there's confusion just coming from the number of different just the sheer number of components involved and also the fact that there's two attacks. I'm not sure exactly which comment you're referring to, but I would guess that in the second attack, which I didn't quite describe the mechanics of yet, in the second attack, the attack was also financed by flash lending, but kind of in a kind of dark poetic turn, it was actually financed by flash lending from BZX itself. If you remember, in the first attack it was a different protocol called dYdX, whose flash lending facility was used. In the second attack, BZX's own flash lending facility was used to finance an exploit of BZX. And I think probably the comment that you're referring to was the BZX team pointing out that essentially it didn't matter where you got this financing for this attack. Right? So BZX's flash lending facility was used to finance the second attack. But the attack would have worked regardless of where the flash lending financing would have come from, if you see what I mean.
00:08:54.582 - 00:09:18.800, Speaker B: So that's why I keep calling it financing, is because I'm emphasizing that the flash lending actually was not a material part of the exploit, or rather, it wasn't a part of the logic that made the exploit possible. It was just a way of finding capital to do it. And that was the case in the second one, that even though it was BZX's capital that was used to do the attack, that part could have been anyone.
00:09:19.410 - 00:09:26.660, Speaker A: Okay, but then for the other attack, for the first attack that really was due to a vulnerability in BZX, is that what you're saying?
00:09:28.390 - 00:09:49.494, Speaker B: I would say that both attacks were due to a vulnerability in BZX. It's just that in the second one, it was BZX's own flash lending facility that was used to finance the exploit of that attack. But I would definitely say that in both cases, it was a deficiency of BZX, of the protocol that was attacked that allowed it to happen.
00:09:49.612 - 00:10:19.246, Speaker A: So in a moment, why don't we dive into the details on the second attack. But first, a quick word from the sponsors who make this show possible. Are you interested in getting into the cryptocurrency markets but don't know where to start building your portfolio? Etoro has the answer for you. It's called CopyTrader by Etoro. With CopyTrader, you can automatically copy every trade of Etoro's top crypto traders at the exact price in real time. No need to study up on markets or develop your own strategies. Simply sign up and copy the trader of your choice.
00:10:19.246 - 00:10:47.322, Speaker A: Any profits they make, you do too proportional to your investment. With Etoro, you get access to the world's most popular cryptocurrencies with transparent trading fees, all in one easy to use app. Copy the smart money with Etoro. Join now@etoro.com. That's eToro.com crypto.com. Have you seen the MZO Visa card? A metal card loaded with Perks, up to 5% back and unlimited airport lounge access.
00:10:47.322 - 00:11:06.974, Speaker A: They pay for your spotify and Netflix too. What's not to love? Crypto.com has recently launched its exchange and crypto fundraising platform, the Syndicate. There was a 50% off atom listing event on February twelveTH, 2020. Sign up on the Crypto.com exchange. Now back to my conversation with Lev Livnev.
00:11:06.974 - 00:11:13.140, Speaker A: So we walked kind of step by step through the first exploit, but can you walk us step by step through the second one?
00:11:13.590 - 00:12:30.880, Speaker B: Sure. So the second exploit know I think a lot of the confusion came from around the coverage of this after the fact came from that. When the first exploit happened, a lot of people kind of looked into the history of BZX and what previous issues there had been with the smart contracts and they found this very informative article from the security researcher Sam Sun from last year when Samsung found Oracle related vulnerabilities in a number of different DeFi smart contracts, including BZX. And these vulnerabilities were all of a similar nature where it turned out it was quite common for smart contracts to make this mistake. And I can go into more detail a bit later of what exactly that problem was, but when the first attack happened, people actually assumed that it was related to, essentially to this attack vector that sam had pointed out. Last year, when in fact, even though it was kind of adjacent to it, I would say that the first attack was actually completely different. Now on the other hand, the second attack was very closely related to the issues that Sam pointed out last year.
00:12:30.880 - 00:13:52.086, Speaker B: So essentially the issues that he pointed out was that a lot of smart contracts, especially ones that were doing lending, had a need for Oracles in order to assess the solvency essentially of positions. So to figure out if collateral value is adequate to cover the value of a loan for this, they need an Oracle for the collateral asset. And kind of as an easy way to get an Oracle. A lot of these smart contracts were looking at decentralized exchanges as a source of an asset's price in order to value the collateral, right? And a lot of them were going to some popular decks like Oasis or Kyber or Uniswap and looking at the price there. And basically what Sam was pointing out in his article, which I kind of recommend you read if you're trying to get background on this because it's to date probably the clearest explanation of this phenomenon. I'm sure some other stuff will come out concerning these recent attacks soon, but this is a very good reference. The essence of it there is that it's in a lot of cases very straightforward for an attacker to do trades on one of those exchanges before calling the functionality of the smart contract that's going to use those exchanges as an Oracle and essentially they can kind of mess up the price there.
00:13:52.086 - 00:14:12.922, Speaker B: Arbitrarily, just before that exchange is uses an Oracle and manipulate it. And a lot of times they can even do this at very, very low cost. So it turns out that for exchanges like Uniswap, it's actually possible to do this in a very cost effective way. So essentially it's like market manipulation, but much, much cheaper than market manipulation is usually. And that's what makes it so dangerous.
00:14:12.986 - 00:14:34.740, Speaker A: And indeed jump in there. The first exploit apparently cost a little over $8 in network fees and the second one $110. And given the amounts of money that they made off with, clearly these fees were not, they were nominal. But anyway, keep going.
00:14:35.050 - 00:15:17.538, Speaker B: Yeah, and I mean there's actually other costs associated with these attacks other than ethereum transaction fees. So for example, in the second attack, what the attacker had to do before calling into BZX is they had to do a trade. And then this trade obviously has a cost coming from a spread and a trading fee or a trading fee or so on. So there are other costs there, but yes, exactly. The point is that these costs are very small when potentially what's at stake is being able to steal almost all of the collateral or almost all of an asset that's available in one of.
00:15:17.544 - 00:15:30.200, Speaker A: These lending platforms just to make sure that we haven't still gone step by step through the second attack. But can you use synthetics and can you just kind of walk us through how that one happened?
00:15:30.730 - 00:16:58.206, Speaker B: Right, so in the second attack, in the first attack, the issue was that there was a kind of a safety check that was actually just incorrectly implemented and never actually properly took effect. In the second attack, it was much closer to the Oracle manipulation issue that Sam pointed out a while ago, but it turned out that the mitigations that had been put in place in order to address that or were thought to address that issue turned out to be insufficient. And I mean, this is where I think it gets very subtle and you really have to be familiar with how these different exchanges work and how they're used as Oracles within BZX in particular. But the gist of it is that the attacker chose to use a market for SUSD against ether. So SUSD is synthetix USD, which is a kind of stable coin that's created by the synthetics protocol. And the reason that the attacker probably chose specifically that market and not any of the other markets is that synthetics is an asset that's traded on or this sorry, synthetics USD is an asset that's traded on Kyber but has a specific property of having two Kyber reserves. And Kyber reserves are essentially like sources of liquidity that the Kyber contract has available to use, one of which was uniswap.
00:16:58.206 - 00:18:12.746, Speaker B: So uniswap is another exchange and another one which is a Kyber specific reserve called an Apr, which stands for automated price Reserve, which is another gadget, which is very, very similar to uniswap. So it actually turns out that these two liquidity sources that were available to Kyber and Kyber was being used as the Oracle were actually very similar and could both be manipulated in a very similar way. While previously, you know, when kind of the mitigations to Sam's discovery were put in place, it was assumed that if there were multiple Kyber reserves for a given market that they worked in a sufficiently different way that they would provide some level of resiliency. And this turned out to be untrue. To understand this, you kind of have to understand exactly because these are both bonding curve based, automated, what people call automated market makers. So pools of liquidity that set prices algorithmically based on the current position of the pool. And because both of these uniswap and this SUSD Apr were so similar, it just turned out that they would both fall to the same manipulation attack.
00:18:12.928 - 00:18:39.554, Speaker A: So what's your main takeaway? Or is it two different takeaways from the two different attacks? Do you think that there's kind of one culprit or a couple culprits that are the cause of this? Do you think that this is some kind of referendum on DeFi in general? Does it just mean that BZX needs to do a better job? What's your takeaway from what happened this past week?
00:18:39.752 - 00:19:48.726, Speaker B: Yeah, well, there's actually a lot of different conclusions here. I mean, one thing is I think that I'll just point out that something that I think people are probably getting wrong in my opinion some of the time is kind of the role of flash lending here. In this case, in both attacks, flash lending was just a financing mechanism for the attack and was not actually materially a part of the vulnerability itself. The second thing that relates to flash lending is that a lot of people have been saying that now we need to kind of reconsider everything with flash lending in the game and that the flash lending has really changed the smart contract security assumptions or something like that. And I think it's possible that for some, the way that some people were thinking about smart contracts was that they were assuming that malicious users or hackers basically would not be well funded, so would not be able to find funding in order to execute attacks. And therefore you should only worry about attacks that were possible without any upfront funding. To me I think it's clear that that was never a good assumption to make.
00:19:48.726 - 00:20:41.318, Speaker B: But what flash lending does is it explicitly invalidates this assumption because now you can use smart contracts to fund your attacks in the vast majority of cases and we discovered this with two hacks in one week. So those are the kind of two points about flash lending that I think are takeaways. For me, I think another takeaway I haven't heard anyone kind of mention this, is that the fact that these two attacks happened in succession, I mean the attacks were actually completely independent of each other, right? So there's nothing about the first attack that made the second attack possible technically speaking. And it's not like the second attack was exploiting a vulnerability that was introduced in the aftermath of the first attack or anything like that. What really happened was probably just getting more eyes on the smart contracts. That's what happened between the first and the second attacks. And it turns out that the second attack was more or less spelled out.
00:20:41.318 - 00:21:25.510, Speaker B: Well, maybe spelled out is a strong word, but was kind of heavily suggested by some of the research that was being done on these smart contracts back in the day when Sam made those initial findings. So to me what that means is that there's really not that many people that are actually looking at these contracts from a security point of view. And it turns out that just calling attention to the possibility of there being an issue with one of them could result four days later in another issue being found. And it's possible that from people looking at these contracts now, that even more issues will be found. I'm speculating here, but essentially what that means is that this whole time no one's been really paying attention.
00:21:26.170 - 00:22:29.718, Speaker A: Yeah, there's something about this that reminds me of the Dow a little bit. And granted, I'm in the middle of writing this book, so maybe I just have the Dow in my brain a little bit too. You know, at that time, the reentrancy bug was talked about before the hack happened on the Dow. And here it's a similar situation where Sam wrote that blog post and someone who maybe was paying a bit closer attention was able to take some lessons from that. So I think there's probably something to be said for a lot of the people in charge of these protocols, really jumping on any sort of hint of any bug that they might see, because if they don't, then somebody else will. But anyway, so thank you so much for coming on the show. And also I wanted to mention, which I didn't get to say at the top of the hour, but you were the one who discovered the first exploit, so kudos to you for that.
00:22:29.904 - 00:22:43.200, Speaker B: Yeah, to clarify, it was seeing the transaction where the exploit had already occurred, so it was obviously the attacker who discovered the exploit and obviously, unfortunately, took advantage of it.
00:22:44.530 - 00:22:48.514, Speaker A: Right, okay. Well, either way, thank you so much for coming on the show.
00:22:48.632 - 00:22:50.114, Speaker B: Of course. Thank you.
00:22:50.312 - 00:23:20.310, Speaker A: Don't forget, next up is the News Recap. Stick around for this week in Crypto after this short break. Crypto law is run by crypto OGS in New York who understand crypto and fintech. They were already operating in the space back in 2013, and they accept crypto as payment. One of the partners, Zachary Kellman, is known for drafting a bill submitted to the US Congress in 2014 aimed at exempting onchain Bitcoin transactions from US. Regulations. The other founding partner, his brother Daniel Kelman, became well known in the Crypto law space for his work in the Mount Gox Civil Rehabilitation.
00:23:20.310 - 00:23:44.978, Speaker A: So if you operate a fintech business or have a dispute with some person or business involving crypto, or you just need legal advice related to crypto, info at Kelman law, that's Kelman law. Or just go to their website at www. Crypto law. When you think crypto, think Kelman. Hi, everyone. Thanks for tuning into this week's News Recap. First story, a close look at Coinbase's business.
00:23:44.978 - 00:24:35.634, Speaker A: Michael Del Castillo, my kinda sorta colleague at Forbes. He and I never overlapped, but I wish we had. He published a great pair of articles this week. One was a feature on Coinbase which dived deeply into the company's business. Michael and his co author William Baldwin estimate that Coinbase has been, quote, solidly in the black for several years and is on track to top $800 million in revenue this year. Plus, they know that the firm has 35 million accounts and presides over $21 billion in assets. In a related news piece, Michael reports that Visa, the credit card giant, has granted Coinbase the power to issue cryptocurrency debit cards with Bitcoin, Ether, XRP, Litecoin, Bitcoin Cash, Bat, Rep, ZRX and Stellar Lumens as the cryptocurrencies available on the card.
00:24:35.634 - 00:25:34.310, Speaker A: The card will be available in 29 countries when it launches later this year, but the US will not be one of them. By the way, the feature story also says that according to Coinbase, it handled $80 billion of transactions last year. Michael and William say that Binance's daily volume annualizes to $1 trillion. So speaking of Binance next Story binance announces new crypto exchange cloud operation Bloomberg reports that Binance is launching a new service lending its technology and liquidity to those who want to launch their own exchanges. CEO Shangpang Zhao predicted to Bloomberg that Binance cloud will become the company's biggest source of revenue in five years. Binance already has one fiat exchange, which it will be ready to announce in the coming weeks. Plus has confirmed four other clients, and Binance will offer these clients access to the order books of existing trading pairs on finance.
00:25:34.310 - 00:27:10.082, Speaker A: More Exchange News FCoin is insolvent due to $130,000,000 shortage in its crypto asset reserve FCoin, a crypto exchange that became known for its controversial trans fee mining model, revealed that it was insolvent due to errors in its internal system. CEO Zhang Jian said in a post that the exchange had been crediting users with more in rewards than it should have. The exchange had issued an exchange token called Ft, and when users pay transaction fees in bitcoin or Ether, the platform would reimburse the user 100% of the value in FTS. Plus, FCoin distributed 80% of the transaction fees in bitcoin to users who held FTS throughout the day. According to Zhang, the system began giving away more in mining rewards than users should have earned starting in mid 2018, but it didn't realize that until a 2019 audit. Next Story DOJ indictment calls operating a bitcoin mixer or tumblr a crime? Larry Harmon of Akron, Ohio And so here's where I would actually normally do a shout out to Akron, because this is the area that I'm from, but it somehow doesn't feel totally appropriate to do with this story anyway. Larry Harmon of Akron, Ohio was arrested for operating of Helix, which the Department of justice alleges laundered over $300 million by moving more than 350,000 bitcoin, with the largest amount coming from darknet markets.
00:27:10.082 - 00:28:03.190, Speaker A: It also alleges that Helix partnered with Darknet Market Alphabet, which was seized by law enforcement in July 2017. Larry's brother told CoinDesk that Helix, which also closed in 2017, did not directly partner with Alphabet and that the market recommended his mixer without input or permission from Larry. Next Story MIT researchers reveal flaws in blockchain based votes voting app MIT researchers Michael A. Spector, James Coppell and Daniel J. Whitester found that it is possible to monitor and even change or block votes in the blockchain based voting app. Votes spelled V-O-A-T-Z. They also announced that the attacks could even taint the paper trail created by the app, which would, of course, make it impossible to audit.
00:28:03.190 - 00:29:16.846, Speaker A: Next Headline DeFi and TBTC make it into Money Stuff yes, the crypto people who geek out about Matt Levine's columns on Bloomberg were excited when he wrote about an announced DeFi project called TBTC, which is a trustless bridge between bitcoin and Ethereum. The TBTC website says, quote Number one deposit BTC, number two mint TBTC and three, lend and earn interest in your BTC project. Lead Matt Luongo calls this an improvement on other Ethereum based tokens pegged to bitcoin, such as wrapped BTC, which actually played a role in the first BZX attack and is a synthetic. He told the block, quote Bitcoiners want to be able to get back to the bitcoin chain. He said for the asset to be considered valid and theirs, they have to be able to redeem trustlessly, and a synthetic doesn't do that. As Matt Levine wrote in his column, if you want to live in Ethereum but own bitcoins, you can. It's like a stablecoin, which I think of as a way to live in Ethereum but own dollars.
00:29:16.846 - 00:30:05.470, Speaker A: This is just a stablecoin pegged to bitcoin. Why not? All right, this week's fun bits. Takerdao tells. MakerDAO expect us. Leave it to Amin, Soleimani of Spank chain and Molokdao to announce his plans to code up a smart contract called Takerdao. Before I tell you all what Amin's plans are regarding Takerdao, let me just mention a blog post by Coin monks from December called how to turn $20 million into $340,000,000 in 15 Seconds, which stated that due to the amount of MKR needed to take control of MakerDAO governance. Quote the naive cost of doing just about whatever you want to the maker contracts is about 80,000 MKR.
00:30:05.470 - 00:30:58.794, Speaker A: Also, let me note that for just this reason, people have been watching the amount of MKR in uniswap, which has been rising precipitously in the past couple of weeks. So with that context, here is a means description of the Takerdao smart contract he plans to launch unless MakerDAO makes some governance changes. He says it would quote one let people pull MKR. Two, wait until the contract has more than 80,000 MKR. Three take over Maker dow Governance. Four Give the MKR depositors all the ETH, and then in parentheses, he wrote $600 million, because right now you can 9% attack maker Dow Governance. Expect us all right, that's it for this week's news recap.
00:30:58.794 - 00:31:31.970, Speaker A: Thanks for tuning in. To learn more about Lev Livnev and the BZX exploits, be sure to check. Out the links in the show notes of your podcast player. If you enjoy these news recaps, then why not sign up for The Real Deal, the weekly newsletter I publish every Friday? Some of you have asked me for the links to the stories I mentioned on the show, and now you can get them delivered right to your inbox. Go to Unchainedpodcast.com right now to sign up. Unchained is produced by Me Laura Shin with help from Fractal recording anthony Yoon, Daniel Ness, Josh Durham and the team at CLK Transcription.
00:31:31.970 - 00:31:33.010, Speaker A: Thanks for listening.
